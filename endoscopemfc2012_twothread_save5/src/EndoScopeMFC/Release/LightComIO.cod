; Listing generated by Microsoft (R) Optimizing Compiler Version 17.00.50727.1 

	TITLE	E:\work_wm\HXIJY_code\endoscopemfc2012_menu_changepara_youhua_savepic_USB_1114_twothread_svepic_save5\src\EndoScopeMFC\LightComIO.cpp
	.686P
	.XMM
	include listing.inc
	.model	flat

INCLUDELIB OLDNAMES

PUBLIC	??_R2CLightComIO@@8				; CLightComIO::`RTTI Base Class Array'
PUBLIC	??_R1A@?0A@EA@CLightComIO@@8			; CLightComIO::`RTTI Base Class Descriptor at (0,-1,0,64)'
PUBLIC	??_R3CLightComIO@@8				; CLightComIO::`RTTI Class Hierarchy Descriptor'
PUBLIC	??_R0?AVCLightComIO@@@8				; CLightComIO `RTTI Type Descriptor'
PUBLIC	??_R4CLightComIO@@6B@				; CLightComIO::`RTTI Complete Object Locator'
PUBLIC	??_7CLightComIO@@6B@				; CLightComIO::`vftable'
EXTRN	__imp__ReadFile@20:PROC
EXTRN	__imp__WriteFile@20:PROC
EXTRN	__imp__PurgeComm@8:PROC
EXTRN	__imp__SetupComm@12:PROC
EXTRN	__imp__SetCommTimeouts@8:PROC
EXTRN	__imp__LocalFree@4:PROC
EXTRN	__imp__GetLastError@0:PROC
EXTRN	__imp__FormatMessageA@28:PROC
EXTRN	__imp__SetCommState@8:PROC
EXTRN	__imp__GetCommState@8:PROC
;	COMDAT ??_7CLightComIO@@6B@
CONST	SEGMENT
??_7CLightComIO@@6B@ DD FLAT:??_R4CLightComIO@@6B@	; CLightComIO::`vftable'
	DD	FLAT:??_ECLightComIO@@UAEPAXI@Z
CONST	ENDS
;	COMDAT ??_R4CLightComIO@@6B@
rdata$r	SEGMENT
??_R4CLightComIO@@6B@ DD 00H				; CLightComIO::`RTTI Complete Object Locator'
	DD	00H
	DD	00H
	DD	FLAT:??_R0?AVCLightComIO@@@8
	DD	FLAT:??_R3CLightComIO@@8
rdata$r	ENDS
;	COMDAT ??_R0?AVCLightComIO@@@8
_DATA	SEGMENT
??_R0?AVCLightComIO@@@8 DD FLAT:??_7type_info@@6B@	; CLightComIO `RTTI Type Descriptor'
	DD	00H
	DB	'.?AVCLightComIO@@', 00H
_DATA	ENDS
;	COMDAT ??_R3CLightComIO@@8
rdata$r	SEGMENT
??_R3CLightComIO@@8 DD 00H				; CLightComIO::`RTTI Class Hierarchy Descriptor'
	DD	00H
	DD	01H
	DD	FLAT:??_R2CLightComIO@@8
rdata$r	ENDS
;	COMDAT ??_R1A@?0A@EA@CLightComIO@@8
rdata$r	SEGMENT
??_R1A@?0A@EA@CLightComIO@@8 DD FLAT:??_R0?AVCLightComIO@@@8 ; CLightComIO::`RTTI Base Class Descriptor at (0,-1,0,64)'
	DD	00H
	DD	00H
	DD	0ffffffffH
	DD	00H
	DD	040H
	DD	FLAT:??_R3CLightComIO@@8
rdata$r	ENDS
;	COMDAT ??_R2CLightComIO@@8
rdata$r	SEGMENT
??_R2CLightComIO@@8 DD FLAT:??_R1A@?0A@EA@CLightComIO@@8 ; CLightComIO::`RTTI Base Class Array'
	ORG $+1
$SG4294953283 DB 'Error', 00H
PUBLIC	?OnRecv@CLightComIO@@QAEIPAX@Z			; CLightComIO::OnRecv
PUBLIC	?RecvHandler@CLightComIO@@SAIPAX@Z		; CLightComIO::RecvHandler
PUBLIC	?Release@CLightComIO@@QAEXXZ			; CLightComIO::Release
PUBLIC	??1CLightComIO@@UAE@XZ				; CLightComIO::~CLightComIO
PUBLIC	??_GCLightComIO@@UAEPAXI@Z			; CLightComIO::`scalar deleting destructor'
PUBLIC	??0CLightComIO@@QAE@XZ				; CLightComIO::CLightComIO
PUBLIC	?SendData@CLightComIO@@QAEHPAEH@Z		; CLightComIO::SendData
EXTRN	??_ECLightComIO@@UAEPAXI@Z:PROC			; CLightComIO::`vector deleting destructor'
;	COMDAT xdata$x
xdata$x	SEGMENT
__ehfuncinfo$?OnRecv@CLightComIO@@QAEIPAX@Z DD 019930522H
	DD	02H
	DD	FLAT:__unwindtable$?OnRecv@CLightComIO@@QAEIPAX@Z
	DD	2 DUP(00H)
	DD	2 DUP(00H)
	DD	00H
	DD	01H
__unwindtable$?OnRecv@CLightComIO@@QAEIPAX@Z DD 0ffffffffH
	DD	FLAT:__unwindfunclet$?OnRecv@CLightComIO@@QAEIPAX@Z$0
	DD	00H
	DD	FLAT:__unwindfunclet$?OnRecv@CLightComIO@@QAEIPAX@Z$1
; Function compile flags: /Odtp
; File e:\work_wm\hxijy_code\endoscopemfc2012_menu_changepara_youhua_savepic_usb_1114_twothread_svepic_save5\src\endoscopemfc\lightcomio.cpp
;	COMDAT ?SendData@CLightComIO@@QAEHPAEH@Z
_TEXT	SEGMENT
_RTN$ = -60						; size = 4
_this$ = -56						; size = 4
_i$1 = -52						; size = 4
_sndsize$ = -48						; size = 2
_pBuf$ = -44						; size = 4
_dwWrite$ = -40						; size = 4
_sndBuf$ = -36						; size = 32
__$ArrayPad$ = -4					; size = 4
_buf$ = 8						; size = 4
_size$ = 12						; size = 4
?SendData@CLightComIO@@QAEHPAEH@Z PROC			; CLightComIO::SendData, COMDAT
; _this$ = ecx

; 134  : {	

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 3c	 sub	 esp, 60			; 0000003cH
  00006	a1 00 00 00 00	 mov	 eax, DWORD PTR ___security_cookie
  0000b	33 c5		 xor	 eax, ebp
  0000d	89 45 fc	 mov	 DWORD PTR __$ArrayPad$[ebp], eax
  00010	89 4d c8	 mov	 DWORD PTR _this$[ebp], ecx

; 135  : 	DWORD dwWrite = 0;

  00013	c7 45 d8 00 00
	00 00		 mov	 DWORD PTR _dwWrite$[ebp], 0

; 136  : 	//添加发送协议
; 137  : 	BYTE* pBuf;
; 138  : 	
; 139  : 	//长度(不包含两位帧头)
; 140  : 	WORD sndsize = size;

  0001a	66 8b 45 0c	 mov	 ax, WORD PTR _size$[ebp]
  0001e	66 89 45 d0	 mov	 WORD PTR _sndsize$[ebp], ax

; 141  : 	
; 142  : 	BYTE sndBuf[32];
; 143  : 	memset(sndBuf, 0, sizeof(sndBuf));

  00022	33 c9		 xor	 ecx, ecx
  00024	89 4d dc	 mov	 DWORD PTR _sndBuf$[ebp], ecx
  00027	89 4d e0	 mov	 DWORD PTR _sndBuf$[ebp+4], ecx
  0002a	89 4d e4	 mov	 DWORD PTR _sndBuf$[ebp+8], ecx
  0002d	89 4d e8	 mov	 DWORD PTR _sndBuf$[ebp+12], ecx
  00030	89 4d ec	 mov	 DWORD PTR _sndBuf$[ebp+16], ecx
  00033	89 4d f0	 mov	 DWORD PTR _sndBuf$[ebp+20], ecx
  00036	89 4d f4	 mov	 DWORD PTR _sndBuf$[ebp+24], ecx
  00039	89 4d f8	 mov	 DWORD PTR _sndBuf$[ebp+28], ecx

; 144  : 	pBuf = sndBuf;

  0003c	8d 55 dc	 lea	 edx, DWORD PTR _sndBuf$[ebp]
  0003f	89 55 d4	 mov	 DWORD PTR _pBuf$[ebp], edx

; 145  : 	
; 146  : 	//帧起始
; 147  : 	*(BYTE*)pBuf = 0xA5;

  00042	8b 45 d4	 mov	 eax, DWORD PTR _pBuf$[ebp]
  00045	c6 00 a5	 mov	 BYTE PTR [eax], 165	; 000000a5H

; 148  : 	pBuf++;

  00048	8b 4d d4	 mov	 ecx, DWORD PTR _pBuf$[ebp]
  0004b	83 c1 01	 add	 ecx, 1
  0004e	89 4d d4	 mov	 DWORD PTR _pBuf$[ebp], ecx

; 149  : 	*(BYTE*)pBuf = 0x5A;

  00051	8b 55 d4	 mov	 edx, DWORD PTR _pBuf$[ebp]
  00054	c6 02 5a	 mov	 BYTE PTR [edx], 90	; 0000005aH

; 150  : 	pBuf++;

  00057	8b 45 d4	 mov	 eax, DWORD PTR _pBuf$[ebp]
  0005a	83 c0 01	 add	 eax, 1
  0005d	89 45 d4	 mov	 DWORD PTR _pBuf$[ebp], eax

; 151  : 
; 152  : 	for( int i=0; i<sndsize; i++)

  00060	c7 45 cc 00 00
	00 00		 mov	 DWORD PTR _i$1[ebp], 0
  00067	eb 09		 jmp	 SHORT $LN3@SendData
$LN2@SendData:
  00069	8b 4d cc	 mov	 ecx, DWORD PTR _i$1[ebp]
  0006c	83 c1 01	 add	 ecx, 1
  0006f	89 4d cc	 mov	 DWORD PTR _i$1[ebp], ecx
$LN3@SendData:
  00072	0f b7 55 d0	 movzx	 edx, WORD PTR _sndsize$[ebp]
  00076	39 55 cc	 cmp	 DWORD PTR _i$1[ebp], edx
  00079	7d 18		 jge	 SHORT $LN1@SendData

; 153  : 	{
; 154  : 		*(BYTE*)pBuf = buf[i];

  0007b	8b 45 08	 mov	 eax, DWORD PTR _buf$[ebp]
  0007e	03 45 cc	 add	 eax, DWORD PTR _i$1[ebp]
  00081	8b 4d d4	 mov	 ecx, DWORD PTR _pBuf$[ebp]
  00084	8a 10		 mov	 dl, BYTE PTR [eax]
  00086	88 11		 mov	 BYTE PTR [ecx], dl

; 155  : 		pBuf++;		

  00088	8b 45 d4	 mov	 eax, DWORD PTR _pBuf$[ebp]
  0008b	83 c0 01	 add	 eax, 1
  0008e	89 45 d4	 mov	 DWORD PTR _pBuf$[ebp], eax

; 156  : 	}

  00091	eb d6		 jmp	 SHORT $LN2@SendData
$LN1@SendData:

; 157  : 	//帧结束
; 158  : // 	*(BYTE*)pBuf = 0x97;
; 159  : // 	pBuf++;
; 160  : // 	*(BYTE*)pBuf = 0x98;
; 161  : // 	pBuf++;
; 162  : 	BOOL RTN = WriteFile(m_hCom, (LPCVOID)sndBuf, sndsize+2, &dwWrite, NULL);

  00093	6a 00		 push	 0
  00095	8d 4d d8	 lea	 ecx, DWORD PTR _dwWrite$[ebp]
  00098	51		 push	 ecx
  00099	0f b7 55 d0	 movzx	 edx, WORD PTR _sndsize$[ebp]
  0009d	83 c2 02	 add	 edx, 2
  000a0	52		 push	 edx
  000a1	8d 45 dc	 lea	 eax, DWORD PTR _sndBuf$[ebp]
  000a4	50		 push	 eax
  000a5	8b 4d c8	 mov	 ecx, DWORD PTR _this$[ebp]
  000a8	8b 51 08	 mov	 edx, DWORD PTR [ecx+8]
  000ab	52		 push	 edx
  000ac	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__WriteFile@20
  000b2	89 45 c4	 mov	 DWORD PTR _RTN$[ebp], eax

; 163  : 
; 164  : 	//打出log代码，实际发布时屏蔽
; 165  : 	/*
; 166  : 	CString cstemp;
; 167  : 	CString csbuf;
; 168  : 	for(int j = 0; j<(pBuf-sndBuf); j++)
; 169  : 	{
; 170  : 		cstemp.Format(_T("%02X "),(unsigned char)sndBuf[j]);
; 171  : 		csbuf = csbuf + cstemp;
; 172  : 	}
; 173  : 	
; 174  : 	TRACE(csbuf);	
; 175  : 	CString filePath;
; 176  : 	filePath = ReturnPath();
; 177  : 	filePath += "\\Voice\\SendCOMLOG.txt";
; 178  : 	WriteComLog(csbuf,filePath);*/
; 179  : 	
; 180  : 	return RTN;

  000b5	8b 45 c4	 mov	 eax, DWORD PTR _RTN$[ebp]

; 181  : }

  000b8	8b 4d fc	 mov	 ecx, DWORD PTR __$ArrayPad$[ebp]
  000bb	33 cd		 xor	 ecx, ebp
  000bd	e8 00 00 00 00	 call	 @__security_check_cookie@4
  000c2	8b e5		 mov	 esp, ebp
  000c4	5d		 pop	 ebp
  000c5	c2 08 00	 ret	 8
?SendData@CLightComIO@@QAEHPAEH@Z ENDP			; CLightComIO::SendData
_TEXT	ENDS
; Function compile flags: /Odtp
; File e:\work_wm\hxijy_code\endoscopemfc2012_menu_changepara_youhua_savepic_usb_1114_twothread_svepic_save5\src\endoscopemfc\lightcomio.cpp
;	COMDAT ??0CLightComIO@@QAE@XZ
_TEXT	SEGMENT
_this$ = -4						; size = 4
??0CLightComIO@@QAE@XZ PROC				; CLightComIO::CLightComIO, COMDAT
; _this$ = ecx

; 21   : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	51		 push	 ecx
  00004	89 4d fc	 mov	 DWORD PTR _this$[ebp], ecx
  00007	8b 45 fc	 mov	 eax, DWORD PTR _this$[ebp]
  0000a	c7 00 00 00 00
	00		 mov	 DWORD PTR [eax], OFFSET ??_7CLightComIO@@6B@

; 22   : 	// 初始化
; 23   : 	m_hCom = INVALID_HANDLE_VALUE;

  00010	8b 4d fc	 mov	 ecx, DWORD PTR _this$[ebp]
  00013	c7 41 08 ff ff
	ff ff		 mov	 DWORD PTR [ecx+8], -1

; 24   : 	m_nBaudRate = CBR_9600; // 初始化波特率

  0001a	8b 55 fc	 mov	 edx, DWORD PTR _this$[ebp]
  0001d	c7 42 10 80 25
	00 00		 mov	 DWORD PTR [edx+16], 9600 ; 00002580H

; 25   : 	m_bExitFlag = TRUE;

  00024	8b 45 fc	 mov	 eax, DWORD PTR _this$[ebp]
  00027	c6 40 04 01	 mov	 BYTE PTR [eax+4], 1

; 26   : 	m_comThread = NULL;

  0002b	8b 4d fc	 mov	 ecx, DWORD PTR _this$[ebp]
  0002e	c7 41 0c 00 00
	00 00		 mov	 DWORD PTR [ecx+12], 0

; 27   : 	m_pDataHandler = NULL;

  00035	8b 55 fc	 mov	 edx, DWORD PTR _this$[ebp]
  00038	c7 42 38 00 00
	00 00		 mov	 DWORD PTR [edx+56], 0

; 28   : }

  0003f	8b 45 fc	 mov	 eax, DWORD PTR _this$[ebp]
  00042	8b e5		 mov	 esp, ebp
  00044	5d		 pop	 ebp
  00045	c3		 ret	 0
??0CLightComIO@@QAE@XZ ENDP				; CLightComIO::CLightComIO
_TEXT	ENDS
; Function compile flags: /Odtp
;	COMDAT ??_GCLightComIO@@UAEPAXI@Z
_TEXT	SEGMENT
_this$ = -4						; size = 4
___flags$ = 8						; size = 4
??_GCLightComIO@@UAEPAXI@Z PROC				; CLightComIO::`scalar deleting destructor', COMDAT
; _this$ = ecx
  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	51		 push	 ecx
  00004	89 4d fc	 mov	 DWORD PTR _this$[ebp], ecx
  00007	8b 4d fc	 mov	 ecx, DWORD PTR _this$[ebp]
  0000a	e8 00 00 00 00	 call	 ??1CLightComIO@@UAE@XZ	; CLightComIO::~CLightComIO
  0000f	8b 45 08	 mov	 eax, DWORD PTR ___flags$[ebp]
  00012	83 e0 01	 and	 eax, 1
  00015	74 0d		 je	 SHORT $LN1@scalar
  00017	8b 4d fc	 mov	 ecx, DWORD PTR _this$[ebp]
  0001a	51		 push	 ecx
  0001b	ff 15 00 00 00
	00		 call	 DWORD PTR __imp_??3@YAXPAX@Z
  00021	83 c4 04	 add	 esp, 4
$LN1@scalar:
  00024	8b 45 fc	 mov	 eax, DWORD PTR _this$[ebp]
  00027	8b e5		 mov	 esp, ebp
  00029	5d		 pop	 ebp
  0002a	c2 04 00	 ret	 4
??_GCLightComIO@@UAEPAXI@Z ENDP				; CLightComIO::`scalar deleting destructor'
_TEXT	ENDS
; Function compile flags: /Odtp
; File e:\work_wm\hxijy_code\endoscopemfc2012_menu_changepara_youhua_savepic_usb_1114_twothread_svepic_save5\src\endoscopemfc\lightcomio.cpp
;	COMDAT ??1CLightComIO@@UAE@XZ
_TEXT	SEGMENT
_this$ = -4						; size = 4
??1CLightComIO@@UAE@XZ PROC				; CLightComIO::~CLightComIO, COMDAT
; _this$ = ecx

; 31   : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	51		 push	 ecx
  00004	89 4d fc	 mov	 DWORD PTR _this$[ebp], ecx
  00007	8b 45 fc	 mov	 eax, DWORD PTR _this$[ebp]
  0000a	c7 00 00 00 00
	00		 mov	 DWORD PTR [eax], OFFSET ??_7CLightComIO@@6B@

; 32   : 	Release();

  00010	8b 4d fc	 mov	 ecx, DWORD PTR _this$[ebp]
  00013	e8 00 00 00 00	 call	 ?Release@CLightComIO@@QAEXXZ ; CLightComIO::Release

; 33   : }

  00018	8b e5		 mov	 esp, ebp
  0001a	5d		 pop	 ebp
  0001b	c3		 ret	 0
??1CLightComIO@@UAE@XZ ENDP				; CLightComIO::~CLightComIO
_TEXT	ENDS
; Function compile flags: /Odtp
; File e:\work_wm\hxijy_code\endoscopemfc2012_menu_changepara_youhua_savepic_usb_1114_twothread_svepic_save5\src\endoscopemfc\lightcomio.cpp
;	COMDAT ?Release@CLightComIO@@QAEXXZ
_TEXT	SEGMENT
_this$ = -4						; size = 4
?Release@CLightComIO@@QAEXXZ PROC			; CLightComIO::Release, COMDAT
; _this$ = ecx

; 118  : {	

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	51		 push	 ecx
  00004	89 4d fc	 mov	 DWORD PTR _this$[ebp], ecx

; 119  : 	if(!m_bExitFlag)

  00007	8b 45 fc	 mov	 eax, DWORD PTR _this$[ebp]
  0000a	0f b6 48 04	 movzx	 ecx, BYTE PTR [eax+4]
  0000e	85 c9		 test	 ecx, ecx
  00010	75 19		 jne	 SHORT $LN2@Release

; 120  : 	{
; 121  : 		m_bExitFlag = TRUE;

  00012	8b 55 fc	 mov	 edx, DWORD PTR _this$[ebp]
  00015	c6 42 04 01	 mov	 BYTE PTR [edx+4], 1

; 122  : 		::WaitForSingleObject(m_comThread->m_hThread,10);

  00019	6a 0a		 push	 10			; 0000000aH
  0001b	8b 45 fc	 mov	 eax, DWORD PTR _this$[ebp]
  0001e	8b 48 0c	 mov	 ecx, DWORD PTR [eax+12]
  00021	8b 51 2c	 mov	 edx, DWORD PTR [ecx+44]
  00024	52		 push	 edx
  00025	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__WaitForSingleObject@8
$LN2@Release:

; 123  : 	}
; 124  : 	if(m_hCom != INVALID_HANDLE_VALUE) 

  0002b	8b 45 fc	 mov	 eax, DWORD PTR _this$[ebp]
  0002e	83 78 08 ff	 cmp	 DWORD PTR [eax+8], -1
  00032	74 17		 je	 SHORT $LN3@Release

; 125  : 	{
; 126  : 		CloseHandle(m_hCom);

  00034	8b 4d fc	 mov	 ecx, DWORD PTR _this$[ebp]
  00037	8b 51 08	 mov	 edx, DWORD PTR [ecx+8]
  0003a	52		 push	 edx
  0003b	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__CloseHandle@4

; 127  : 		m_hCom = INVALID_HANDLE_VALUE;

  00041	8b 45 fc	 mov	 eax, DWORD PTR _this$[ebp]
  00044	c7 40 08 ff ff
	ff ff		 mov	 DWORD PTR [eax+8], -1
$LN3@Release:

; 128  : 	}
; 129  : 
; 130  : }

  0004b	8b e5		 mov	 esp, ebp
  0004d	5d		 pop	 ebp
  0004e	c3		 ret	 0
?Release@CLightComIO@@QAEXXZ ENDP			; CLightComIO::Release
_TEXT	ENDS
; Function compile flags: /Odtp
; File e:\work_wm\hxijy_code\endoscopemfc2012_menu_changepara_youhua_savepic_usb_1114_twothread_svepic_save5\src\endoscopemfc\lightcomio.cpp
;	COMDAT ?RecvHandler@CLightComIO@@SAIPAX@Z
_TEXT	SEGMENT
_lpParam$ = 8						; size = 4
?RecvHandler@CLightComIO@@SAIPAX@Z PROC			; CLightComIO::RecvHandler, COMDAT

; 185  : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp

; 186  : 	return ((CLightComIO*)(lpParam))->OnRecv(lpParam);

  00003	8b 45 08	 mov	 eax, DWORD PTR _lpParam$[ebp]
  00006	50		 push	 eax
  00007	8b 4d 08	 mov	 ecx, DWORD PTR _lpParam$[ebp]
  0000a	e8 00 00 00 00	 call	 ?OnRecv@CLightComIO@@QAEIPAX@Z ; CLightComIO::OnRecv

; 187  : }

  0000f	5d		 pop	 ebp
  00010	c3		 ret	 0
?RecvHandler@CLightComIO@@SAIPAX@Z ENDP			; CLightComIO::RecvHandler
_TEXT	ENDS
; Function compile flags: /Odtp
; File e:\work_wm\hxijy_code\endoscopemfc2012_menu_changepara_youhua_savepic_usb_1114_twothread_svepic_save5\src\endoscopemfc\lightcomio.cpp
;	COMDAT ?OnRecv@CLightComIO@@QAEIPAX@Z
_TEXT	SEGMENT
_pCom$ = -84						; size = 4
$T2 = -80						; size = 4
$T3 = -76						; size = 4
_bRet$ = -72						; size = 4
_j$4 = -68						; size = 4
_this$ = -64						; size = 4
_dbgbuf$ = -60						; size = 4
_dbgtemp$ = -56						; size = 4
_dwSize$ = -52						; size = 4
_buf$ = -48						; size = 32
__$ArrayPad$ = -16					; size = 4
__$EHRec$ = -12						; size = 12
_lpParam$ = 8						; size = 4
?OnRecv@CLightComIO@@QAEIPAX@Z PROC			; CLightComIO::OnRecv, COMDAT
; _this$ = ecx

; 191  : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	6a ff		 push	 -1
  00005	68 00 00 00 00	 push	 __ehhandler$?OnRecv@CLightComIO@@QAEIPAX@Z
  0000a	64 a1 00 00 00
	00		 mov	 eax, DWORD PTR fs:0
  00010	50		 push	 eax
  00011	83 ec 48	 sub	 esp, 72			; 00000048H
  00014	a1 00 00 00 00	 mov	 eax, DWORD PTR ___security_cookie
  00019	33 c5		 xor	 eax, ebp
  0001b	89 45 f0	 mov	 DWORD PTR __$ArrayPad$[ebp], eax
  0001e	50		 push	 eax
  0001f	8d 45 f4	 lea	 eax, DWORD PTR __$EHRec$[ebp]
  00022	64 a3 00 00 00
	00		 mov	 DWORD PTR fs:0, eax
  00028	89 4d c0	 mov	 DWORD PTR _this$[ebp], ecx

; 192  : 	CLightComIO* pCom =(CLightComIO*)lpParam;

  0002b	8b 45 08	 mov	 eax, DWORD PTR _lpParam$[ebp]
  0002e	89 45 ac	 mov	 DWORD PTR _pCom$[ebp], eax

; 193  : 	DWORD dwSize=0;

  00031	c7 45 cc 00 00
	00 00		 mov	 DWORD PTR _dwSize$[ebp], 0

; 194  : 	BOOL bRet = TRUE;

  00038	c7 45 b8 01 00
	00 00		 mov	 DWORD PTR _bRet$[ebp], 1

; 195  : 	BYTE buf[32] = {0};

  0003f	c6 45 d0 00	 mov	 BYTE PTR _buf$[ebp], 0
  00043	33 c9		 xor	 ecx, ecx
  00045	89 4d d1	 mov	 DWORD PTR _buf$[ebp+1], ecx
  00048	89 4d d5	 mov	 DWORD PTR _buf$[ebp+5], ecx
  0004b	89 4d d9	 mov	 DWORD PTR _buf$[ebp+9], ecx
  0004e	89 4d dd	 mov	 DWORD PTR _buf$[ebp+13], ecx
  00051	89 4d e1	 mov	 DWORD PTR _buf$[ebp+17], ecx
  00054	89 4d e5	 mov	 DWORD PTR _buf$[ebp+21], ecx
  00057	89 4d e9	 mov	 DWORD PTR _buf$[ebp+25], ecx
  0005a	66 89 4d ed	 mov	 WORD PTR _buf$[ebp+29], cx
  0005e	88 4d ef	 mov	 BYTE PTR _buf$[ebp+31], cl

; 196  : 	CString dbgbuf,dbgtemp;

  00061	8d 4d c4	 lea	 ecx, DWORD PTR _dbgbuf$[ebp]
  00064	ff 15 00 00 00
	00		 call	 DWORD PTR __imp_??0?$CStringT@DV?$StrTraitMFC_DLL@DV?$ChTraitsCRT@D@ATL@@@@@ATL@@QAE@XZ
  0006a	c7 45 fc 00 00
	00 00		 mov	 DWORD PTR __$EHRec$[ebp+8], 0
  00071	8d 4d c8	 lea	 ecx, DWORD PTR _dbgtemp$[ebp]
  00074	ff 15 00 00 00
	00		 call	 DWORD PTR __imp_??0?$CStringT@DV?$StrTraitMFC_DLL@DV?$ChTraitsCRT@D@ATL@@@@@ATL@@QAE@XZ
  0007a	c6 45 fc 01	 mov	 BYTE PTR __$EHRec$[ebp+8], 1
$LN15@OnRecv:

; 197  : 
; 198  : 	while (1) 

  0007e	ba 01 00 00 00	 mov	 edx, 1
  00083	85 d2		 test	 edx, edx
  00085	0f 84 02 02 00
	00		 je	 $LN14@OnRecv

; 199  : 	{		
; 200  : 		dwSize = 0;

  0008b	c7 45 cc 00 00
	00 00		 mov	 DWORD PTR _dwSize$[ebp], 0

; 201  :  		bRet = ReadFile(m_hCom,			  // 串口句柄
; 202  : 						m_rBuf + m_rSize, // 缓冲
; 203  : 						1,				  // 完成一次读串口操作需要读出的字节数总数
; 204  : 						&dwSize,	      // 完成一次读串口操作后实际读出的字节总数
; 205  : 						NULL );

  00092	6a 00		 push	 0
  00094	8d 45 cc	 lea	 eax, DWORD PTR _dwSize$[ebp]
  00097	50		 push	 eax
  00098	6a 01		 push	 1
  0009a	8b 4d c0	 mov	 ecx, DWORD PTR _this$[ebp]
  0009d	8b 51 14	 mov	 edx, DWORD PTR [ecx+20]
  000a0	8b 45 c0	 mov	 eax, DWORD PTR _this$[ebp]
  000a3	8d 4c 10 18	 lea	 ecx, DWORD PTR [eax+edx+24]
  000a7	51		 push	 ecx
  000a8	8b 55 c0	 mov	 edx, DWORD PTR _this$[ebp]
  000ab	8b 42 08	 mov	 eax, DWORD PTR [edx+8]
  000ae	50		 push	 eax
  000af	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__ReadFile@20
  000b5	89 45 b8	 mov	 DWORD PTR _bRet$[ebp], eax

; 206  : 
; 207  : 
; 208  : 		// 串口无效，关闭串口就退出了线程
; 209  : 		if(!bRet) {

  000b8	83 7d b8 00	 cmp	 DWORD PTR _bRet$[ebp], 0
  000bc	75 2c		 jne	 SHORT $LN13@OnRecv

; 210  : 			return 0;

  000be	c7 45 b4 00 00
	00 00		 mov	 DWORD PTR $T3[ebp], 0
  000c5	c6 45 fc 00	 mov	 BYTE PTR __$EHRec$[ebp+8], 0
  000c9	8d 4d c8	 lea	 ecx, DWORD PTR _dbgtemp$[ebp]
  000cc	ff 15 00 00 00
	00		 call	 DWORD PTR __imp_??1?$CStringT@DV?$StrTraitMFC_DLL@DV?$ChTraitsCRT@D@ATL@@@@@ATL@@QAE@XZ
  000d2	c7 45 fc ff ff
	ff ff		 mov	 DWORD PTR __$EHRec$[ebp+8], -1
  000d9	8d 4d c4	 lea	 ecx, DWORD PTR _dbgbuf$[ebp]
  000dc	ff 15 00 00 00
	00		 call	 DWORD PTR __imp_??1?$CStringT@DV?$StrTraitMFC_DLL@DV?$ChTraitsCRT@D@ATL@@@@@ATL@@QAE@XZ
  000e2	8b 45 b4	 mov	 eax, DWORD PTR $T3[ebp]
  000e5	e9 ca 01 00 00	 jmp	 $LN16@OnRecv
$LN13@OnRecv:

; 211  : 		}
; 212  : 
; 213  : 		// 如果读到数据
; 214  : 		if(dwSize > 0) 

  000ea	83 7d cc 00	 cmp	 DWORD PTR _dwSize$[ebp], 0
  000ee	0f 86 8c 01 00
	00		 jbe	 $LN12@OnRecv

; 215  : 		{
; 216  : 			m_rSize += dwSize;

  000f4	8b 4d c0	 mov	 ecx, DWORD PTR _this$[ebp]
  000f7	8b 51 14	 mov	 edx, DWORD PTR [ecx+20]
  000fa	03 55 cc	 add	 edx, DWORD PTR _dwSize$[ebp]
  000fd	8b 45 c0	 mov	 eax, DWORD PTR _this$[ebp]
  00100	89 50 14	 mov	 DWORD PTR [eax+20], edx

; 217  : 		
; 218  : 			//检查起始位A55A
; 219  : 			if( m_rSize==1 )

  00103	8b 4d c0	 mov	 ecx, DWORD PTR _this$[ebp]
  00106	83 79 14 01	 cmp	 DWORD PTR [ecx+20], 1
  0010a	75 41		 jne	 SHORT $LN11@OnRecv

; 220  : 			{
; 221  : 				if(m_rBuf[0] != 0xA5 )

  0010c	ba 01 00 00 00	 mov	 edx, 1
  00111	6b d2 00	 imul	 edx, 0
  00114	8b 45 c0	 mov	 eax, DWORD PTR _this$[ebp]
  00117	0f b6 4c 10 18	 movzx	 ecx, BYTE PTR [eax+edx+24]
  0011c	81 f9 a5 00 00
	00		 cmp	 ecx, 165		; 000000a5H
  00122	74 29		 je	 SHORT $LN11@OnRecv

; 222  : 				{
; 223  : 					//把接收数位置零
; 224  : 					m_rSize = 0;

  00124	8b 55 c0	 mov	 edx, DWORD PTR _this$[ebp]
  00127	c7 42 14 00 00
	00 00		 mov	 DWORD PTR [edx+20], 0

; 225  : 					//清BUF
; 226  : 					memset(m_rBuf,0,sizeof(m_rBuf));

  0012e	33 c0		 xor	 eax, eax
  00130	8b 4d c0	 mov	 ecx, DWORD PTR _this$[ebp]
  00133	83 c1 18	 add	 ecx, 24			; 00000018H
  00136	89 01		 mov	 DWORD PTR [ecx], eax
  00138	89 41 04	 mov	 DWORD PTR [ecx+4], eax
  0013b	89 41 08	 mov	 DWORD PTR [ecx+8], eax
  0013e	89 41 0c	 mov	 DWORD PTR [ecx+12], eax
  00141	89 41 10	 mov	 DWORD PTR [ecx+16], eax
  00144	89 41 14	 mov	 DWORD PTR [ecx+20], eax
  00147	89 41 18	 mov	 DWORD PTR [ecx+24], eax
  0014a	89 41 1c	 mov	 DWORD PTR [ecx+28], eax
$LN11@OnRecv:

; 227  : 				}
; 228  : 			}
; 229  : 			
; 230  : 			if(m_rSize==2)

  0014d	8b 55 c0	 mov	 edx, DWORD PTR _this$[ebp]
  00150	83 7a 14 02	 cmp	 DWORD PTR [edx+20], 2
  00154	75 3e		 jne	 SHORT $LN9@OnRecv

; 231  : 			{
; 232  : 				if(m_rBuf[1] != 0x5A )

  00156	b8 01 00 00 00	 mov	 eax, 1
  0015b	c1 e0 00	 shl	 eax, 0
  0015e	8b 4d c0	 mov	 ecx, DWORD PTR _this$[ebp]
  00161	0f b6 54 01 18	 movzx	 edx, BYTE PTR [ecx+eax+24]
  00166	83 fa 5a	 cmp	 edx, 90			; 0000005aH
  00169	74 29		 je	 SHORT $LN9@OnRecv

; 233  : 				{
; 234  : 					m_rSize = 0;

  0016b	8b 45 c0	 mov	 eax, DWORD PTR _this$[ebp]
  0016e	c7 40 14 00 00
	00 00		 mov	 DWORD PTR [eax+20], 0

; 235  : 					memset(m_rBuf,0,sizeof(m_rBuf));

  00175	33 c9		 xor	 ecx, ecx
  00177	8b 55 c0	 mov	 edx, DWORD PTR _this$[ebp]
  0017a	83 c2 18	 add	 edx, 24			; 00000018H
  0017d	89 0a		 mov	 DWORD PTR [edx], ecx
  0017f	89 4a 04	 mov	 DWORD PTR [edx+4], ecx
  00182	89 4a 08	 mov	 DWORD PTR [edx+8], ecx
  00185	89 4a 0c	 mov	 DWORD PTR [edx+12], ecx
  00188	89 4a 10	 mov	 DWORD PTR [edx+16], ecx
  0018b	89 4a 14	 mov	 DWORD PTR [edx+20], ecx
  0018e	89 4a 18	 mov	 DWORD PTR [edx+24], ecx
  00191	89 4a 1c	 mov	 DWORD PTR [edx+28], ecx
$LN9@OnRecv:

; 236  : 				}
; 237  : 			}
; 238  : 
; 239  : 			//接收指定长度帧
; 240  : 			if( m_rBuf[2]==(m_rSize-3) )

  00194	b8 01 00 00 00	 mov	 eax, 1
  00199	d1 e0		 shl	 eax, 1
  0019b	8b 4d c0	 mov	 ecx, DWORD PTR _this$[ebp]
  0019e	0f b6 54 01 18	 movzx	 edx, BYTE PTR [ecx+eax+24]
  001a3	8b 45 c0	 mov	 eax, DWORD PTR _this$[ebp]
  001a6	8b 48 14	 mov	 ecx, DWORD PTR [eax+20]
  001a9	83 e9 03	 sub	 ecx, 3
  001ac	3b d1		 cmp	 edx, ecx
  001ae	0f 85 98 00 00
	00		 jne	 $LN7@OnRecv

; 241  : 			{					
; 242  : 				for( int j = 0; j < m_rSize ; j++ )

  001b4	c7 45 bc 00 00
	00 00		 mov	 DWORD PTR _j$4[ebp], 0
  001bb	eb 09		 jmp	 SHORT $LN6@OnRecv
$LN5@OnRecv:
  001bd	8b 55 bc	 mov	 edx, DWORD PTR _j$4[ebp]
  001c0	83 c2 01	 add	 edx, 1
  001c3	89 55 bc	 mov	 DWORD PTR _j$4[ebp], edx
$LN6@OnRecv:
  001c6	8b 45 c0	 mov	 eax, DWORD PTR _this$[ebp]
  001c9	8b 4d bc	 mov	 ecx, DWORD PTR _j$4[ebp]
  001cc	3b 48 14	 cmp	 ecx, DWORD PTR [eax+20]
  001cf	73 12		 jae	 SHORT $LN4@OnRecv

; 243  : 				{
; 244  : 					buf[j] = m_rBuf[j];

  001d1	8b 55 c0	 mov	 edx, DWORD PTR _this$[ebp]
  001d4	03 55 bc	 add	 edx, DWORD PTR _j$4[ebp]
  001d7	8b 45 bc	 mov	 eax, DWORD PTR _j$4[ebp]
  001da	8a 4a 18	 mov	 cl, BYTE PTR [edx+24]
  001dd	88 4c 05 d0	 mov	 BYTE PTR _buf$[ebp+eax], cl

; 245  : 				}

  001e1	eb da		 jmp	 SHORT $LN5@OnRecv
$LN4@OnRecv:

; 246  : 
; 247  : 				//给主窗口发送消息
; 248  : 				if ( m_pDataHandler )

  001e3	8b 55 c0	 mov	 edx, DWORD PTR _this$[ebp]
  001e6	83 7a 38 00	 cmp	 DWORD PTR [edx+56], 0
  001ea	74 1d		 je	 SHORT $LN3@OnRecv

; 249  : 					m_pDataHandler->ProcessData(buf,m_rSize);

  001ec	8b 45 c0	 mov	 eax, DWORD PTR _this$[ebp]
  001ef	8b 48 14	 mov	 ecx, DWORD PTR [eax+20]
  001f2	51		 push	 ecx
  001f3	8d 55 d0	 lea	 edx, DWORD PTR _buf$[ebp]
  001f6	52		 push	 edx
  001f7	8b 45 c0	 mov	 eax, DWORD PTR _this$[ebp]
  001fa	8b 48 38	 mov	 ecx, DWORD PTR [eax+56]
  001fd	8b 55 c0	 mov	 edx, DWORD PTR _this$[ebp]
  00200	8b 01		 mov	 eax, DWORD PTR [ecx]
  00202	8b 4a 38	 mov	 ecx, DWORD PTR [edx+56]
  00205	8b 10		 mov	 edx, DWORD PTR [eax]
  00207	ff d2		 call	 edx
$LN3@OnRecv:

; 250  : 
; 251  : 				m_rSize = 0;

  00209	8b 45 c0	 mov	 eax, DWORD PTR _this$[ebp]
  0020c	c7 40 14 00 00
	00 00		 mov	 DWORD PTR [eax+20], 0

; 252  : 				memset(m_rBuf,0,sizeof(m_rBuf));

  00213	33 c9		 xor	 ecx, ecx
  00215	8b 55 c0	 mov	 edx, DWORD PTR _this$[ebp]
  00218	83 c2 18	 add	 edx, 24			; 00000018H
  0021b	89 0a		 mov	 DWORD PTR [edx], ecx
  0021d	89 4a 04	 mov	 DWORD PTR [edx+4], ecx
  00220	89 4a 08	 mov	 DWORD PTR [edx+8], ecx
  00223	89 4a 0c	 mov	 DWORD PTR [edx+12], ecx
  00226	89 4a 10	 mov	 DWORD PTR [edx+16], ecx
  00229	89 4a 14	 mov	 DWORD PTR [edx+20], ecx
  0022c	89 4a 18	 mov	 DWORD PTR [edx+24], ecx
  0022f	89 4a 1c	 mov	 DWORD PTR [edx+28], ecx

; 253  : 
; 254  : 
; 255  : 				//打出log代码，实际发布时屏蔽
; 256  : 				/*dbgbuf.Empty();
; 257  : 				dbgtemp.Empty();
; 258  : 				for(int x = 0; x < j+2; x++)
; 259  : 				{
; 260  : 					dbgtemp.Format(_T("%02X "),buf[x]);
; 261  : 					dbgbuf = dbgbuf + dbgtemp;
; 262  : 				}
; 263  : 				CString filePath;
; 264  : 				filePath = ReturnPath();
; 265  : 				filePath += "\\Voice\\COMLOG.txt";
; 266  : 				WriteComLog(dbgbuf,filePath);
; 267  : 				TRACE(dbgbuf);*/
; 268  : 				//缓冲清理					
; 269  : 				memset(buf,0,32);	

  00232	33 c0		 xor	 eax, eax
  00234	89 45 d0	 mov	 DWORD PTR _buf$[ebp], eax
  00237	89 45 d4	 mov	 DWORD PTR _buf$[ebp+4], eax
  0023a	89 45 d8	 mov	 DWORD PTR _buf$[ebp+8], eax
  0023d	89 45 dc	 mov	 DWORD PTR _buf$[ebp+12], eax
  00240	89 45 e0	 mov	 DWORD PTR _buf$[ebp+16], eax
  00243	89 45 e4	 mov	 DWORD PTR _buf$[ebp+20], eax
  00246	89 45 e8	 mov	 DWORD PTR _buf$[ebp+24], eax
  00249	89 45 ec	 mov	 DWORD PTR _buf$[ebp+28], eax
$LN7@OnRecv:

; 270  : 			}
; 271  : 
; 272  : 
; 273  : 			//接收长度太长的情况下清空
; 274  : 			if( m_rSize>=64 )

  0024c	8b 4d c0	 mov	 ecx, DWORD PTR _this$[ebp]
  0024f	83 79 14 40	 cmp	 DWORD PTR [ecx+20], 64	; 00000040H
  00253	72 29		 jb	 SHORT $LN2@OnRecv

; 275  : 			{
; 276  : 				m_rSize=0;

  00255	8b 55 c0	 mov	 edx, DWORD PTR _this$[ebp]
  00258	c7 42 14 00 00
	00 00		 mov	 DWORD PTR [edx+20], 0

; 277  : 				memset(m_rBuf, 0, sizeof(m_rBuf));

  0025f	33 c0		 xor	 eax, eax
  00261	8b 4d c0	 mov	 ecx, DWORD PTR _this$[ebp]
  00264	83 c1 18	 add	 ecx, 24			; 00000018H
  00267	89 01		 mov	 DWORD PTR [ecx], eax
  00269	89 41 04	 mov	 DWORD PTR [ecx+4], eax
  0026c	89 41 08	 mov	 DWORD PTR [ecx+8], eax
  0026f	89 41 0c	 mov	 DWORD PTR [ecx+12], eax
  00272	89 41 10	 mov	 DWORD PTR [ecx+16], eax
  00275	89 41 14	 mov	 DWORD PTR [ecx+20], eax
  00278	89 41 18	 mov	 DWORD PTR [ecx+24], eax
  0027b	89 41 1c	 mov	 DWORD PTR [ecx+28], eax
$LN2@OnRecv:

; 278  : 			}
; 279  : 		}
; 280  : 		// 没有读到数据
; 281  : 		else {

  0027e	eb 08		 jmp	 SHORT $LN1@OnRecv
$LN12@OnRecv:

; 282  : 			Sleep(1);

  00280	6a 01		 push	 1
  00282	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__Sleep@4
$LN1@OnRecv:

; 283  : 		}
; 284  : 	}

  00288	e9 f1 fd ff ff	 jmp	 $LN15@OnRecv
$LN14@OnRecv:

; 285  : 	return 1;

  0028d	c7 45 b0 01 00
	00 00		 mov	 DWORD PTR $T2[ebp], 1
  00294	c6 45 fc 00	 mov	 BYTE PTR __$EHRec$[ebp+8], 0
  00298	8d 4d c8	 lea	 ecx, DWORD PTR _dbgtemp$[ebp]
  0029b	ff 15 00 00 00
	00		 call	 DWORD PTR __imp_??1?$CStringT@DV?$StrTraitMFC_DLL@DV?$ChTraitsCRT@D@ATL@@@@@ATL@@QAE@XZ
  002a1	c7 45 fc ff ff
	ff ff		 mov	 DWORD PTR __$EHRec$[ebp+8], -1
  002a8	8d 4d c4	 lea	 ecx, DWORD PTR _dbgbuf$[ebp]
  002ab	ff 15 00 00 00
	00		 call	 DWORD PTR __imp_??1?$CStringT@DV?$StrTraitMFC_DLL@DV?$ChTraitsCRT@D@ATL@@@@@ATL@@QAE@XZ
  002b1	8b 45 b0	 mov	 eax, DWORD PTR $T2[ebp]
$LN16@OnRecv:

; 286  : }

  002b4	8b 4d f4	 mov	 ecx, DWORD PTR __$EHRec$[ebp]
  002b7	64 89 0d 00 00
	00 00		 mov	 DWORD PTR fs:0, ecx
  002be	59		 pop	 ecx
  002bf	8b 4d f0	 mov	 ecx, DWORD PTR __$ArrayPad$[ebp]
  002c2	33 cd		 xor	 ecx, ebp
  002c4	e8 00 00 00 00	 call	 @__security_check_cookie@4
  002c9	8b e5		 mov	 esp, ebp
  002cb	5d		 pop	 ebp
  002cc	c2 04 00	 ret	 4
_TEXT	ENDS
;	COMDAT text$x
text$x	SEGMENT
__unwindfunclet$?OnRecv@CLightComIO@@QAEIPAX@Z$0:
  00000	8d 4d c4	 lea	 ecx, DWORD PTR _dbgbuf$[ebp]
  00003	ff 25 00 00 00
	00		 jmp	 DWORD PTR __imp_??1?$CStringT@DV?$StrTraitMFC_DLL@DV?$ChTraitsCRT@D@ATL@@@@@ATL@@QAE@XZ
__unwindfunclet$?OnRecv@CLightComIO@@QAEIPAX@Z$1:
  00009	8d 4d c8	 lea	 ecx, DWORD PTR _dbgtemp$[ebp]
  0000c	ff 25 00 00 00
	00		 jmp	 DWORD PTR __imp_??1?$CStringT@DV?$StrTraitMFC_DLL@DV?$ChTraitsCRT@D@ATL@@@@@ATL@@QAE@XZ
__ehhandler$?OnRecv@CLightComIO@@QAEIPAX@Z:
  00012	8b 54 24 08	 mov	 edx, DWORD PTR [esp+8]
  00016	8d 42 0c	 lea	 eax, DWORD PTR [edx+12]
  00019	8b 4a b4	 mov	 ecx, DWORD PTR [edx-76]
  0001c	33 c8		 xor	 ecx, eax
  0001e	e8 00 00 00 00	 call	 @__security_check_cookie@4
  00023	8b 4a fc	 mov	 ecx, DWORD PTR [edx-4]
  00026	33 c8		 xor	 ecx, eax
  00028	e8 00 00 00 00	 call	 @__security_check_cookie@4
  0002d	b8 00 00 00 00	 mov	 eax, OFFSET __ehfuncinfo$?OnRecv@CLightComIO@@QAEIPAX@Z
  00032	e9 00 00 00 00	 jmp	 ___CxxFrameHandler3
text$x	ENDS
?OnRecv@CLightComIO@@QAEIPAX@Z ENDP			; CLightComIO::OnRecv
END
